<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="storefront-item-wrapper.html">

<dom-module id="storefront-group">
  <template>
    <style include="shared-styles">
      :host(:not([hidden])) {
        display: block;
        margin-top: var(--valo-space-s);
      }

      .heading {
        margin: var(--valo-space-m) 0 var(--valo-space-s) var(--valo-space-s);
      }

      .main {
        color: var(--valo-body-text-color);
        margin-right: var(--valo-space-s);
        font-weight: bold;
      }

      .secondary {
        color: var(--valo-secondary-text-color);
      }

      @media (min-width: 600px) {
        :host {
          flex-direction: column;
        }

        .heading {
          margin: var(--valo-space-m) var(--valo-space-s) var(--valo-space-s);
        }
      }

    </style>

    <div class="heading">
      <span class="main" theme$="[[_getMainFontSize(desktopView)]]">[[group.mainTitle]]</span>
      <span class="secondary" theme$="[[_getSecondaryFontSize(desktopView)]]">[[group.secondaryTitle]]</span>
    </div>
    <iron-list items="[[group.orders]]" id="list">
      <template>
        <storefront-item-wrapper
            order="[[item]]"
            on-open="_selectItem"
            on-close="_unselectItem"
            desktop-view="[[desktopView]]">
        </storefront-item-wrapper>
      </template>
    </iron-list>

  </template>

  <script>
    class StorefrontGroup extends Polymer.Element {
      static get is() {
        return 'storefront-group';
      }

      static get properties() {
        return {
          desktopView: Boolean,
          group: {
            type: Object
          }
        };
      }

      _getMainFontSize(desktop) {
        return desktop ? 'l-text' : 'm-text';
      }

      _getSecondaryFontSize(desktop) {
        return desktop ? 'm-text' : 's-text';
      }

      _selectItem(e) {
        e.target.selected = true;
        this._notifyResize();
      }

      _unselectItem(e) {
        e.target.selected = false;
        this._notifyResize();
      }

      _notifyResize() {
        // iron-list needs to be resized both before and after rendering the list.
        // Without double resize, elements will be rendered on top of each others.
        this.$.list.notifyResize();
        this.dispatchEvent(new CustomEvent('notify-resize'));
        Polymer.RenderStatus.afterNextRender(this, () => {
          this.$.list.notifyResize();
          this.dispatchEvent(new CustomEvent('notify-resize'));
        });
      }
    }

    window.customElements.define(StorefrontGroup.is, StorefrontGroup);
  </script>
</dom-module>
