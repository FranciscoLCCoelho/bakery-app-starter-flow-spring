<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="item-detail-dialog.html">

<dom-module id="items-view">
  <template>
    <style include="shared-styles">
      :host {
        display: flex;
        flex: 1;
        flex-direction: column-reverse;
        box-sizing: border-box;
      }

      .grid-wrapper {
        flex: 1;
        position: relative;
      }

      .grid-wrapper ::slotted([slot="grid"]) {
        position: absolute;
        width: 100%;
        height: 100%;
        --divider-color: transparent;
        overflow: hidden;
        color: var(--valo-secondary-text-color);

        --vaadin-grid-header-cell: {
          height: 64px;
          color: var(--valo-secondary-text-color);
          font-size: var(--valo-font-size-s);
          border-bottom: 1px solid var(--valo-shade-5pct);
        };

        --vaadin-grid-body-cell: {
          border-bottom: 1px solid var(--valo-shade-5pct);
        };
      }

      vaadin-grid-sorter {
        width: 70px;
      }

      @media (min-width: 600px) {
        :host {
          flex-direction: column;
        }

        .grid-wrapper {
          max-width: calc(964px + var(--valo-space-m)) !important;
          margin: 0 auto;
        }

        .grid-wrapper ::slotted([slot="grid"]) {
          padding: var(--valo-space-s) 0;
        }
      }
    </style>

    <slot name="item-search"></slot>

    <div class="flex flex1 overflow-auto">
      <div class="grid-wrapper">
        <slot name="grid"></slot>
      </div>

      <div class="editor-wrapper">
        <item-detail-dialog opened="[[editing]]" side="right" desktop-view$=[[desktopView]] on-before-close="_onBeforeClose">
          <slot name="editor"></slot>
        </item-detail-dialog>
      </div>
    </div>
  </template>

  <script>
    class ItemsView extends Polymer.Element {
      static get is() {
        return 'items-view';
      }

      static get properties() {
        return {
          desktopView: Boolean,
          item: {
            type: Object,
            observer: '_onItemChanged'
          },
          editing: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          }
        };
      }

      _onItemChanged(item) {
        this.editing = !!item;
      }

      _onBeforeClose(e) {
        // We need to forward the event because the dialog before-close event does not bubble.
        e.stopPropagation();
        var customEvent = new CustomEvent('before-close',
          {bubbles: true, composed: true, cancelable: true, detail: this.item});
        this.dispatchEvent(customEvent);
        if (customEvent.defaultPrevented) {
          e.preventDefault();
        }
      }
    }

    window.customElements.define(ItemsView.is, ItemsView);
  </script>
</dom-module>
