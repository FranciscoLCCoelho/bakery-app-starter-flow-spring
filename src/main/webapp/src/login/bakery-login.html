<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-password-field.html">
<link rel="import" href="../../bower_components/vaadin-button/vaadin-button.html">

<dom-module id="bakery-login">
  <template>
    <style include="shared-styles">
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      :host {
        height: 100%;

        /* workaround for a WebKit issue */
        height: 100vh;
      }

      .body {
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .info {
        background-image: url(../../images/login-banner.jpg);
        background-size: cover;
        background-position-x: center;
        display: table;
        width: 100%;
        padding: var(--valo-space-l);
      }

      .info__header {
        font-weight: 300;
        color: var(--valo-base-color);
        margin-top: 2em;
        margin-bottom: 0;
      }

      .info__text {
        font-size: var(--valo-font-size-s);
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
        margin: 0;
      }

      .login {
        padding: var(--valo-space-l);
        background-color: var(--valo-base-color);
        flex: 1;
      }

      .login__header {
        margin-top: 0;
        margin-bottom: 0;
      }

      .login__layout {
        display: flex;
        flex-direction: column;
      }

      .login__layout > * {
        width: 100%;
      }

      .login__button {
        margin-top: var(--valo-space-m);
        margin-left: 0;
        margin-right: 0;
        position: relative;
      }

      .login__button-icon {
        text-align: right;
        position: absolute;
        right: var(--valo-space-s);
      }

      .error {
        display: flex;
        align-items: flex-start;
      }

      .error__icon {
        flex: 0 0 auto;
        width: 1em;
        fill: var(--valo-error-color);
        margin-top: 1.3em;
        margin-right: var(--valo-space-s);
      }

      .error__text {
        max-width: 35em;
      }

      @media (min-width: 1000px) {
        .body {
          max-width: 700px;
          height: auto;
          margin: 20vh auto 0;
          box-shadow: 0 2px 5px 0 rgba(23, 68, 128, 0.1);
        }

        .info {
          border-top-left-radius: 4px;
          border-top-right-radius: 4px;
        }

        .login {
          border-bottom-left-radius: 4px;
          border-bottom-right-radius: 4px;
        }

        .login__layout {
          flex-direction: row;
          align-items: flex-end;
        }

        .login__layout > *:not(:first-child) {
          margin-left: var(--valo-space-m);
        }

        .login__button {
          max-width: 7em;
        }

        .login__button-icon {
          position: static;
        }
      }
    </style>
    <div class="body">
      <div class="info">
        <h1 class="info__header">###Bakery###</h1>
        <p class="info__text">
          admin@vaadin.com + admin <br>
          barista@vaadin.com + barista
        </p>
      </div>
      <iron-form class="login" id="form" allow-redirect>
        <form method="post" action="login">
          <h2 class="login__header">Sign in</h2>
          <div class="login__layout">
            <vaadin-text-field id="username" name="username" label="Email" autofocus required></vaadin-text-field>
            <vaadin-password-field id="password" name="password" label="Password" required on-keydown="_onPasswordKeydown"></vaadin-password-field>
            <vaadin-button id="button-submit" class="login__button" on-tap="login" theme="primary">
              Sign In <span class="login__button-icon">â†’</span>
            </vaadin-button>
          </div>
          <template is="dom-if" if="[[error]]">
            <div class="error">
              <svg class="error__icon" viewBox="0 0 16 16">
                <path d="M8 1c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zM8 0c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8v0z"></path>
                <path d="M7 3h2v7h-2v-7z"></path>
                <path d="M7 11h2v2h-2v-2z"></path>
              </svg>
              <p class="error__text">
                The username and password you entered do not match our records. Please double-check and try again.
              </p>
            </div>
          </template>
        </form>
      </iron-form>
    </div>
  </template>
  <script>
    class BakeryLogin extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() {
        return 'bakery-login';
      }

      static get properties() {
        return {
          error: {
            type: Boolean,
            value: false
          }
        };
      }

      login() {
        if (!this.$.username.invalid && !this.$.password.invalid) {
          this.$.form.submit();
        }
      }

      _onPasswordKeydown(event) {
        if (event.key === 'Enter') {
          this.login();
        }
      }
    }

    window.customElements.define(BakeryLogin.is, BakeryLogin);
  </script>
</dom-module>
