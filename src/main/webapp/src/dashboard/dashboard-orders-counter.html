<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/vaadin-charts/vaadin-chart.html">
<link rel="import" href="dashboard-counter-label.html">


<dom-module id="dashboard-orders-counter">
  <template>
    <style>
      :host {
        position: relative;
        text-align: center;
        height: calc(18vh - 64px);
        min-height: 180px;
        padding: 10px;
      }

      .counter-label {
        position: absolute;
        display: block;
        top: 0;
        height: 100%;
        width: 100%;
        left: 0;
        box-sizing: border-box;
      }

      .chart-wrapper {
        height: 120px;
        display: block;
        padding-top: 5px;
      }

    </style>

    <div class="chart-wrapper" >
      <vaadin-chart id="gauge" class="counter">
        <vaadin-chart-series values="[[_computeValues(data.count)]]"></vaadin-chart-series>
      </vaadin-chart>
    </div>
    <dashboard-counter-label label-data="[[data]]" class="green counter-label"></dashboard-counter-label>
  </template>

  <script>
    class DashboardOrdersCounter extends Polymer.Element {
      static get is() {
        return 'dashboard-orders-counter';
      }

      static get properties() {
        return {
          data: {
            type: Object,
            reflectToAttribute: true
          }
        };
      }

      static get observers() {
        return [
          '_onOverallChanged(data.overall)'
        ];
      }

      _computeValues(count) {
        return [{
          y: count,
          radius: '110%',
          innerRadius: '100%'
        }];
      }

      _onOverallChanged(overall) {
        Polymer.RenderStatus.beforeNextRender(this, () => {
          this.$.gauge.configuration.yAxis[0].max = overall;
        });
      }

      connectedCallback() {
        super.connectedCallback();
        this.$.gauge.update({
          title: {
            text: ''
          },
          chart: {
            type: 'solidgauge'
          },
          series: [{
            name: 'Orders'
          }],
          tooltip: {
            enabled: 'false'
          },
          yAxis: [{
            min: 0,
            max: 1,
            lineWidth: 0,
            labels: {
              enabled: false
            },
            center: {
              y: 0,
              x: 0
            }
          }],
          plotOptions: {
            solidgauge: {
              dataLabels: {
                y: 0,
                borderWidth: 0,
                useHTML: true,
                format: '<div></div>'
              }
            }
          },
          pane: {
            startAngle: 0,
            endAngle: 360,
            background: {
              shape: 'arc',
              innerRadius: '100%',
              outerRadius: '110%'
            }
          }
        }, true);
      }
    }
    window.customElements.define(DashboardOrdersCounter.is, DashboardOrdersCounter);
  </script>
</dom-module>
