<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/vaadin-board/vaadin-board.html">
<link rel="import" href="../../bower_components/vaadin-board/vaadin-board-row.html">

<link rel="import" href="dashboard-orders-counter.html">
<link rel="import" href="dashboard-column-chart.html">
<link rel="import" href="dashboard-yearly-sales.html">
<link rel="import" href="dashboard-pie-chart.html">
<link rel="import" href="dashboard-orders-list.html">
<link rel="import" href="dashboard-counter-label.html">

<dom-module id="dashboard-chart-styles" theme-for="vaadin-chart">
  <template>
    <style include="vaadin-charts-default-theme">
    :host(.counter),
    :host(.counter) #chart {
      height: 120px;
    }

    :host(.counter) .highcharts-color-0 {
      fill: #55bf3b;
      stroke: #55bf3b;
    }

    :host(.counter) .highcharts-pane {
      fill: rgba(23, 68, 128, 0.1);
      stroke-width: 0;
    }

    :host(.counter) .highcharts-background {
      fill: transparent;
    }

    :host(.counter) .highcharts-minor-grid-line,
    :host(.counter) .highcharts-grid-line {
      stroke: none;
    }

    </style>
  </template>
</dom-module>

<dom-module id="bakery-dashboard">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        width: 100%;
        padding: var(--valo-space-s);
        -webkit-overflow-scrolling: touch;
        overflow-y: scroll;
      }

      dashboard-pie-chart,
      dashboard-orders-list {
        --fourth-row-style: {
          border-radius: 4px;
          box-shadow: 0 2px 5px 0 rgba(23, 68, 128, 0.1);
          height: calc(40vh - 64px) !important;
          min-height: 355px;
        }
      }

      vaadin-board vaadin-board-row:nth-child(2) > * {
        --column-chart-height: {
          height: calc(20vh - 64px) !important;
          min-height: 150px;
        }
      }

      vaadin-board-row:not(.small) > * {
        --margin-style: {
          margin: 12px 6px;
        };
      }

      vaadin-board-row.small > * {
        --margin-style: {
          margin: 6px 0;
        };
      }

    </style>

    <vaadin-board>
      <vaadin-board-row>
        <dashboard-orders-counter data="[[todayOrdersCount]]"></dashboard-orders-counter>
        <dashboard-counter-label label-data="[[notAvailableOrdersCount]]" class="red"></dashboard-counter-label>
        <dashboard-counter-label label-data="[[newOrdersCount]]" class="blue"></dashboard-counter-label>
        <dashboard-counter-label label-data="[[tomorrowOrdersCount]]" class="gray"></dashboard-counter-label>
      </vaadin-board-row>
      <vaadin-board-row>
        <dashboard-column-chart data="[[deliveriesThisMonth]]"></dashboard-column-chart>
        <dashboard-column-chart data="[[deliveriesThisYear]]"></dashboard-column-chart>
      </vaadin-board-row>
      <vaadin-board-row>
        <dashboard-yearly-sales series="[[salesGraphSeries]]" title="[[salesGraphTitle]]"></dashboard-yearly-sales>
      </vaadin-board-row>
      <vaadin-board-row>
        <dashboard-pie-chart data="[[productDeliveriesThisMonth]]"></dashboard-pie-chart>
        <dashboard-orders-list id="ordersList" orders-count="[[ordersCount]]" on-page-request="loadOrdersPage" active-item="{{activeItem}}"></dashboard-orders-list>
      </vaadin-board-row>
    </vaadin-board>
  </template>

  <script>
    class BakeryDashboard extends Polymer.Element {
      static get is() {
        return 'bakery-dashboard';
      }

      static get properties() {
        return {
          activeItem: {
            observer: '_activeItemChanged'
          },
          pageInfo: {
            value: {}
          }
        };
      }

      _activeItemChanged(item) {
        if (item) {
          this.$server.navigateToOrderDetails(item.id);
        }
      }

      loadPage() {
        this.$.ordersList.loadPage(this.pageInfo);
      }
    }

    window.customElements.define(BakeryDashboard.is, BakeryDashboard);
  </script>
</dom-module>
