<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../elements/utils-mixin.html">
<link rel="import" href="storefront-item-badge.html">

<dom-module id="storefront-item">
  <template>
    <style include="shared-styles">
      :host {
        display: flex;
        padding: var(--valo-space-l) var(--valo-space-s);
        cursor: pointer;
      }

      .flex {
        display: flex;
      }

      #info-wrapper {
        flex-direction: column-reverse;
        justify-content: flex-end;
      }

      storefront-item-badge {
        margin: var(--valo-space-s) 0;
      }

      #storefront-item-status {
        width: 100px;
      }

      #time-place {
        width: 120px;
      }

      #name-items {
        flex: 1;
      }

      #place,
      #secondary-time,
      #full-day,
      #goods {
        color: var(--valo-secondary-text-color);
      }

      h3 {
        margin: 0;
      }

      #goods {
        display: flex;
        flex-wrap: wrap;
      }

      #goods > div {
        box-sizing: border-box;
        width: 18em;
        flex: auto;
        padding-right: var(--valo-space-l);
      }

      .goods-item {
        display: flex;
        align-items: baseline;
        font-size: var(--valo-font-size-s);
        margin: var(--valo-space-xs) 0;
      }

      .goods-item > .count {
        margin-right: var(--valo-space-s);
      }

      .goods-item > div {
        flex: auto;
      }

      @media (min-width: 600px) {
        :host {
          padding: var(--valo-space-l);
        }

        #info-wrapper {
          flex-direction: row;
        }

        storefront-item-badge {
          margin: 0;
        }
      }
    </style>

    <div id="info-wrapper" class="flex">
      <storefront-item-badge id="storefront-item-status" status="[[item.state]]"></storefront-item-badge>

      <div id="time-place">
        <template is="dom-if" if="[[_isRecent(item.dueDate.date)]]">
          <h3 id="month">[[_getMonth(item.dueDate.date)]]</h3>
          <div id="full-day">[[_getFullDay(item.dueDate.date)]]</div>
        </template>

        <template is="dom-if" if="[[_isYesterday(item.dueDate.date)]]">
          <h3 id="time">[[item.dueTime]]</h3>
          <div id="place">[[item.pickupLocation.name]]</div>
        </template>

        <template is="dom-if" if="[[_isToday(item.dueDate.date)]]">
          <h3 id="time">[[item.dueTime]]</h3>
          <div id="place">[[item.pickupLocation.name]]</div>
        </template>

        <template is="dom-if" if="[[_isThisWeekBeforeYesterday(item.dueDate.date)]]">
          <h3 id="short-day">[[_getShortDay(item.dueDate.date)]]</h3>
          <div id="secondary-time">[[item.dueTime]]</div>
          <div id="place">[[item.pickupLocation.name]]</div>
        </template>

        <template is="dom-if" if="[[_isThisWeekStartingTomorrow(item.dueDate.date)]]">
          <h3 id="short-day">[[_getShortDay(item.dueDate.date)]]</h3>
          <div id="secondary-time">[[item.dueTime]]</div>
          <div id="place">[[item.pickupLocation.name]]</div>
        </template>

        <template is="dom-if" if="[[_isUpcoming(item.dueDate.date)]]">
          <h3 id="month">[[_getMonth(item.dueDate.date)]]</h3>
          <div id="full-day">[[_getFullDay(item.dueDate.date)]]</div>
        </template>
      </div>
    </div>

    <div id="name-items">
      <h3 id="name">[[item.customer.fullName]]</h3>
      <div id="goods">
        <template is="dom-repeat" items="[[item.items]]">
          <div class="goods-item">
            <span class="count">[[item.quantity]]</span>
            <div>[[item.product.name]]</div>
          </div>
        </template>
      </div>
    </div>
  </template>

  <script>
    class StorefrontItem extends window.LocaleUtilsMixin(Polymer.Element) {
      static get is() {
        return 'storefront-item';
      }

      static get properties() {
        return {
          item: {
            type: Object
          }
        };
      }

    }

    window.customElements.define(StorefrontItem.is, StorefrontItem);
  </script>
</dom-module>
