<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="order-item-editor.html">
<link rel="import" href="../elements/utils-mixin.html">
<link rel="import" href="../app/style-modules/shared-styles.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/icons.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/vaadin-date-picker/vaadin-date-picker.html">

<dom-module id="order-editor">
  <template>
   <style include="shared-styles">
      :host {
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        height: 100%;
      }

      .at-icon {
        display: inline-block;
        width: 24px;
        height: 24px;
        font-size: 18px;
        line-height: 24px;
        text-align: center;
      }

      .at-icon::before {
        content: '@';
      }
    </style>

    <div class="scrollable flex1" id="main">
      <h2 id="title"></h2>

      <iron-form id="itemEditForm">
        <form on-submit="_submitEditForm">

          <vaadin-form-layout responsive-steps="[[_computeResponsiveSteps(desktopView, 4, 1)]]">
            <vaadin-form-layout responsive-steps='[{"columns": 1, "labelsPosition": "top"}]'>

              <vaadin-combo-box label="Status" id="status">
              </vaadin-combo-box>

              <vaadin-form-item>
                <label slot="label">Due</label>
                <vaadin-form-layout responsive-steps="[[_computeResponsiveSteps(desktopView, 1, 2)]]">
                  <vaadin-date-picker  id="due-date">
                  </vaadin-date-picker>

                  <vaadin-combo-box id="due-time" allow-custom-value>
                    <iron-icon slot="prefix" icon="valo:clock"></iron-icon>
                  </vaadin-combo-box>
                </vaadin-form-layout>

              </vaadin-form-item>

              <vaadin-combo-box id="pickup-location" class="full-width">
                <div slot="prefix" class="at-icon"></div>
              </vaadin-combo-box>
            </vaadin-form-layout>

            <vaadin-form-layout responsive-steps="[[_computeResponsiveSteps(desktopView, 3, 1)]]" colspan="3">

              <vaadin-text-field id="customer-name" label="Customer" colspan="2">
                <iron-icon slot="prefix" icon="valo:user"></iron-icon>
              </vaadin-text-field>

              <vaadin-text-field id="customer-number" label="Phone number">
                <iron-icon slot="prefix" icon="valo:phone"></iron-icon>
              </vaadin-text-field>

              <vaadin-text-field  id="customer-details" label="Additional Details" colspan="2"></vaadin-text-field>

              <vaadin-form-item colspan="3">
                <label slot="label">Products</label>
                <slot name="order-items-editor"></slot>
              </vaadin-form-item>

            </vaadin-form-layout>
          </vaadin-form-layout>
        </form>
      </iron-form>
    </div>

    <div id="footer" class="footer">
      <vaadin-button id="cancel">Cancel</vaadin-button>
      <div class="total money">Total [[totalPrice]]</div>
      <vaadin-button id="review" theme="primary">Review Order â†’</vaadin-button>
    </div>
  </template>

  <script>
    class OrderEditor extends window.ScrollShadowMixin(Polymer.Element) {

      static get is() {
        return 'order-editor';
      }

      static get properties() {
        return {
          desktopView: {
            type: Boolean,
            observer: '_updateDesktopViewOnItemsEdit'
          },
          status: {
            type: String,
            observer: '_onStatusChange'
          }
        };
      }

      ready() {
        super.ready();
        this.$['status'].$.input.setAttribute('theme', 'status');
      }

      _updateDesktopViewOnItemsEdit() {
        this.querySelectorAll('order-item-editor').forEach(item => item.updateDesktopView(this.desktopView));
      }

      _onStatusChange() {
        const status = this.status ? this.status.toLowerCase() : this.status;
        this.$['status'].$.input.setAttribute('status', status);
      }

      _computeResponsiveSteps(desktopView, desktopColumns, mobileColumns) {
        return [{
          columns: desktopView ? desktopColumns : mobileColumns,
          labelsPosition: 'top'
        }];
      }
    }

    window.customElements.define(OrderEditor.is, OrderEditor);
  </script>
</dom-module>
